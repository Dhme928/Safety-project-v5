<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Safety Observer Pro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="header-left">
        <img src="https://i.imgur.com/YqWBL5v.png" alt="CAT Logo" class="header-logo">
        <div class="header-title">
          <h1 data-t="appName">Safety Observer Pro</h1>
          <p data-t="orgName">Saudi Safety Group - CAT Project</p>
        </div>
      </div>
      <div class="header-right">
        <button id="newsToggleButton" class="icon-btn" title="News"><i class="fas fa-bell"></i></button>
        <div id="pointsDisplay" class="points-display" style="display:none">
          <i class="fas fa-star"></i>
          <span id="userPoints">0</span>
          <span id="userBadge" class="user-badge" style="display:none"></span>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div id="HomeTab" class="tab-content active">
        <div class="kpi-grid">
          <div class="kpi-card kpi-obs"><div class="kpi-label" data-t="observationsToday">Observations Today</div><div id="homeObsToday" class="kpi-value">0</div></div>
          <div class="kpi-card kpi-permits"><div class="kpi-label" data-t="permitsToday">Permits Today</div><div id="homePermitsToday" class="kpi-value">0</div></div>
          <div class="kpi-card kpi-tbt"><div class="kpi-label" data-t="tbtToday">TBT Today</div><div id="homeTbtToday" class="kpi-value">0</div></div>
        </div>

        <div class="color-code-row">
          <span data-t="colorCodeMonth">Color Code This Month:</span>
          <span id="colorName" class="month-color-badge">-</span>
        </div>

        <div id="weatherWidget" class="weather-widget"></div>

        <div class="home-card">
          <div class="home-card-header"><i class="fas fa-hard-hat text-yellow"></i><span data-t="tbtOfDay">TBT of The Day</span></div>
          <div id="homeTbtContent" class="home-card-body">Loading...</div>
        </div>

        <div class="home-card">
          <div class="home-card-header"><i class="fas fa-trophy text-yellow"></i><span data-t="employeeOfMonth">Employee of the Month</span></div>
          <div id="employeeOfMonth" class="home-card-body">Loading...</div>
        </div>

        <div class="home-card">
          <div class="home-card-header"><i class="fas fa-medal text-yellow"></i><span data-t="topPerformers">Top Safety Performers</span><a href="#" onclick="openModal('leaderboardModal');return false" class="card-link" data-t="fullLeaderboard">Full Leaderboard</a></div>
          <div id="homeLeaderboardMini" class="home-card-body leaderboard-mini">Loading...</div>
        </div>

        <div class="home-card">
          <div class="home-card-header"><i class="fas fa-chart-pie text-yellow"></i><span data-t="topAreasChart">Top 5 Areas</span></div>
          <div id="topAreasChart" class="home-card-body"></div>
        </div>

        <button class="accordion" data-t="monthlyLeaderboard"><i class="fas fa-trophy"></i> Monthly Leaderboard</button>
        <div class="panel"><div id="leaderboardContainer"></div></div>

        <button class="accordion" data-t="emergencyContacts"><i class="fas fa-phone-alt"></i> Emergency Contacts</button>
        <div class="panel">
          <div class="contact-item"><span>Emergency Hotline</span><a href="tel:911">911</a></div>
          <div class="contact-item"><span>Safety Office</span><a href="tel:+966123456789">+966 12 345 6789</a></div>
          <div class="contact-item"><span>Medical Center</span><a href="tel:+966198765432">+966 19 876 5432</a></div>
        </div>

        <button class="accordion" data-t="emergencyReporting"><i class="fas fa-exclamation-triangle"></i> Emergency Reporting</button>
        <div class="panel">
          <p>In case of emergency:</p>
          <ol><li>Ensure your safety first</li><li>Call emergency hotline</li><li>Report to supervisor</li><li>Document the incident</li></ol>
        </div>

        <button class="accordion" data-t="safetyResponsibilities"><i class="fas fa-clipboard-check"></i> Safety Responsibilities</button>
        <div class="panel">
          <ul><li>Follow all safety procedures</li><li>Wear required PPE at all times</li><li>Report hazards immediately</li><li>Attend safety meetings</li></ul>
        </div>

        <button class="accordion" data-t="evacuationTips"><i class="fas fa-running"></i> Evacuation Tips</button>
        <div class="panel">
          <ul><li>Know your evacuation routes</li><li>Do not use elevators</li><li>Proceed to assembly point</li><li>Wait for headcount</li></ul>
        </div>

        <button class="accordion" data-t="usefulLinks"><i class="fas fa-link"></i> Useful Links</button>
        <div class="panel">
          <a href="#" class="useful-link">Safety Manual</a>
          <a href="#" class="useful-link">Training Portal</a>
          <a href="#" class="useful-link">Incident Reporting</a>
        </div>
      </div>

      <div id="ObservationsTab" class="tab-content">
        <div class="tab-header">
          <h2 data-t="observe">Observations</h2>
          <button class="btn btn-primary" onclick="openModal('addObservationModal')"><i class="fas fa-plus"></i> <span data-t="addObservation">Add</span></button>
        </div>
        <div class="stats-row">
          <div class="stat-card"><span class="stat-value" id="obsCountTotal">0</span><span class="stat-label" data-t="total">Total</span></div>
          <div class="stat-card"><span class="stat-value" id="obsCountOpen">0</span><span class="stat-label" data-t="open">Open</span></div>
          <div class="stat-card"><span class="stat-value" id="obsCountClosed">0</span><span class="stat-label" data-t="closed">Closed</span></div>
        </div>
        <div class="filter-chips">
          <button class="obs-filter-chip" data-range="today" data-t="today">Today</button>
          <button class="obs-filter-chip" data-range="week" data-t="thisWeek">This Week</button>
          <button class="obs-filter-chip active" data-range="month" data-t="thisMonth">This Month</button>
          <button class="obs-filter-chip" data-range="all" data-t="all">All</button>
        </div>
        <div class="filter-row">
          <select id="obsFilterArea"><option value="" data-t="selectArea">All Areas</option></select>
          <select id="obsFilterStatus"><option value="">All Status</option><option value="Open" data-t="open">Open</option><option value="Closed" data-t="closed">Closed</option></select>
        </div>
        <input type="text" id="obsSearch" class="search-input" data-t-placeholder="search" placeholder="Search...">
        <div id="observationsList" class="cards-list"></div>
      </div>

      <div id="PermitsTab" class="tab-content">
        <div class="tab-header">
          <h2 data-t="permits">Permits</h2>
          <button class="btn btn-primary" onclick="openModal('addPermitModal')"><i class="fas fa-plus"></i> <span data-t="addPermit">Add</span></button>
        </div>
        <div class="stats-row">
          <div class="stat-card"><span class="stat-value" id="permitsCountTotal">0</span><span class="stat-label" data-t="total">Total</span></div>
          <div class="stat-card"><span class="stat-value" id="permitsCountAreas">0</span><span class="stat-label" data-t="area">Areas</span></div>
          <div class="stat-card"><span class="stat-value" id="permitsCountToday">0</span><span class="stat-label" data-t="today">Today</span></div>
        </div>
        <div class="filter-chips">
          <button class="permits-chip active" data-range="today" data-t="today">Today</button>
          <button class="permits-chip" data-range="week" data-t="thisWeek">This Week</button>
          <button class="permits-chip" data-range="month" data-t="thisMonth">This Month</button>
          <button class="permits-chip" data-range="all" data-t="all">All</button>
        </div>
        <div class="filter-row">
          <select id="permitsFilterArea"><option value="" data-t="selectArea">All Areas</option></select>
          <select id="permitsFilterType"><option value="">All Types</option></select>
        </div>
        <input type="text" id="permitsSearch" class="search-input" data-t-placeholder="search" placeholder="Search...">
        <div id="permitsList" class="cards-list"></div>
      </div>

      <div id="EquipmentTab" class="tab-content">
        <div class="tab-header">
          <h2 data-t="equipment">Heavy Equipment</h2>
          <button class="btn btn-primary" onclick="openModal('addEquipmentModal')"><i class="fas fa-plus"></i> <span data-t="addEquipment">Add</span></button>
        </div>
        <div class="stats-row">
          <div class="stat-card"><span class="stat-value" id="eqCountTotal">0</span><span class="stat-label" data-t="total">Total</span></div>
          <div class="stat-card"><span class="stat-value" id="eqCountTps">0</span><span class="stat-label">TPS <span data-t="expiring">Exp</span></span></div>
          <div class="stat-card"><span class="stat-value" id="eqCountIns">0</span><span class="stat-label">INS <span data-t="expiring">Exp</span></span></div>
        </div>
        <div class="filter-row">
          <select id="eqFilterArea"><option value="" data-t="selectArea">All Areas</option></select>
          <select id="eqFilterStatus"><option value="">All Status</option><option value="In Service" data-t="inService">In Service</option><option value="Out of Service" data-t="outOfService">Out of Service</option></select>
        </div>
        <input type="text" id="eqSearch" class="search-input" data-t-placeholder="search" placeholder="Search...">
        <div id="equipmentList" class="cards-list"></div>
      </div>

      <div id="TbtTab" class="tab-content">
        <div class="tab-header">
          <h2 data-t="toolboxTalks">Toolbox Talks</h2>
          <button class="btn btn-primary" onclick="openModal('addTbtModal')"><i class="fas fa-plus"></i> <span data-t="addTbt">Add</span></button>
        </div>
        <div class="stats-row">
          <div class="stat-card"><span class="stat-value" id="tbtCountTotal">0</span><span class="stat-label" data-t="total">Total</span></div>
          <div class="stat-card"><span class="stat-value" id="tbtAvgAttendance">0</span><span class="stat-label" data-t="avgAttendance">Avg Attendance</span></div>
        </div>
        <div class="filter-chips">
          <button class="tbt-chip active" data-range="today" data-t="today">Today</button>
          <button class="tbt-chip" data-range="week" data-t="thisWeek">This Week</button>
          <button class="tbt-chip" data-range="month" data-t="thisMonth">This Month</button>
          <button class="tbt-chip" data-range="all" data-t="all">All</button>
        </div>
        <input type="text" id="tbtSearch" class="search-input" data-t-placeholder="search" placeholder="Search...">
        <div id="tbtList" class="cards-list"></div>
      </div>

      <div id="LibraryTab" class="tab-content">
        <div class="tab-header"><h2 data-t="library">Library</h2></div>
        <div class="library-grid">
          <div class="library-card" onclick="openLibrarySection('tbt')"><i class="fas fa-clipboard-list"></i><span data-t="tbtLibrary">TBT Documents</span></div>
          <div class="library-card" onclick="openLibrarySection('jsa')"><i class="fas fa-file-alt"></i><span data-t="jsaLibrary">JSA Documents</span></div>
          <div class="library-card" onclick="openLibrarySection('csm')"><i class="fas fa-book"></i><span data-t="csmLibrary">CSM Documents</span></div>
        </div>
        <div id="libraryContent" style="display:none">
          <button class="btn btn-secondary" onclick="closeLibrarySection()"><i class="fas fa-arrow-left"></i> <span data-t="close">Back</span></button>
          <input type="text" id="librarySearch" class="search-input" data-t-placeholder="search" placeholder="Search...">
          <div id="libraryList" class="library-list"></div>
        </div>
      </div>

      <div id="ToolsTab" class="tab-content">
        <div class="tab-header"><h2 data-t="tools">Safety Tools</h2></div>
        <div class="tools-grid">
          <div class="tool-card" onclick="toggleToolSection('heatStress')"><i class="fas fa-thermometer-half"></i><span data-t="heatStress">Heat Stress</span></div>
          <div class="tool-card" onclick="toggleToolSection('windSpeed')"><i class="fas fa-wind"></i><span data-t="windSpeed">Wind Speed</span></div>
          <div class="tool-card" onclick="toggleToolSection('riskMatrix')"><i class="fas fa-th"></i><span data-t="riskMatrix">Risk Matrix</span></div>
          <div class="tool-card" onclick="toggleToolSection('trainingMatrix')"><i class="fas fa-graduation-cap"></i><span data-t="trainingMatrix">Training Matrix</span></div>
          <div class="tool-card" onclick="toggleToolSection('lifeSaving')"><i class="fas fa-heartbeat"></i><span data-t="lifeSavingRules">Life Saving Rules</span></div>
          <div class="tool-card" onclick="toggleToolSection('challenges')"><i class="fas fa-flag-checkered"></i><span data-t="challenges">Challenges</span></div>
        </div>

        <div id="heatStressSection" class="tool-section" style="display:none">
          <h3 data-t="heatStress">Heat Stress Calculator</h3>
          <div class="calc-form">
            <label data-t="temperature">Temperature (C)</label>
            <input type="number" id="inputTemp" placeholder="35">
            <label data-t="humidity">Humidity (%)</label>
            <input type="number" id="inputHumidity" placeholder="60">
            <button class="btn btn-primary" onclick="calculateHeatIndex()" data-t="calculate">Calculate</button>
          </div>
          <div class="calc-result">
            <div><span data-t="heatIndex">Heat Index:</span> <strong id="heatIndexResult">-</strong></div>
            <div id="heatRiskLevel" class="risk-status">-</div>
          </div>
        </div>

        <div id="windSpeedSection" class="tool-section" style="display:none">
          <h3 data-t="windSpeed">Wind Speed Monitor</h3>
          <div class="calc-form">
            <label data-t="windSpeedKmh">Wind Speed (km/h)</label>
            <input type="number" id="inputWind" placeholder="25">
            <button class="btn btn-primary" onclick="calculateWindSafety()" data-t="checkSafety">Check Safety</button>
          </div>
          <div class="calc-result">
            <div><span data-t="status">Status:</span> <strong id="windResult">-</strong></div>
            <div id="windRestrictions">-</div>
          </div>
        </div>

        <div id="riskMatrixSection" class="tool-section" style="display:none">
          <h3 data-t="riskMatrix">Risk Assessment Matrix</h3>
          <div class="risk-matrix">
            <div class="matrix-row header"><span></span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></div>
            <div class="matrix-row"><span>5</span><span class="m">5</span><span class="h">10</span><span class="h">15</span><span class="e">20</span><span class="e">25</span></div>
            <div class="matrix-row"><span>4</span><span class="l">4</span><span class="m">8</span><span class="h">12</span><span class="h">16</span><span class="e">20</span></div>
            <div class="matrix-row"><span>3</span><span class="l">3</span><span class="m">6</span><span class="m">9</span><span class="h">12</span><span class="h">15</span></div>
            <div class="matrix-row"><span>2</span><span class="l">2</span><span class="l">4</span><span class="m">6</span><span class="m">8</span><span class="h">10</span></div>
            <div class="matrix-row"><span>1</span><span class="l">1</span><span class="l">2</span><span class="l">3</span><span class="l">4</span><span class="m">5</span></div>
          </div>
        </div>

        <div id="trainingMatrixSection" class="tool-section" style="display:none">
          <h3 data-t="trainingMatrix">Training Matrix</h3>
          <p>Access training requirements and certifications for different job roles.</p>
        </div>

        <div id="lifeSavingSection" class="tool-section" style="display:none">
          <h3 data-t="lifeSavingRules">Life Saving Rules</h3>
          <ul class="life-saving-list">
            <li><i class="fas fa-check-circle"></i> Work with valid permit</li>
            <li><i class="fas fa-check-circle"></i> Verify isolation before work</li>
            <li><i class="fas fa-check-circle"></i> Obtain authorization for confined space</li>
            <li><i class="fas fa-check-circle"></i> Protect against falls</li>
            <li><i class="fas fa-check-circle"></i> Control flammables and ignition</li>
            <li><i class="fas fa-check-circle"></i> Drive safely</li>
            <li><i class="fas fa-check-circle"></i> Follow lifting procedures</li>
          </ul>
        </div>

        <div id="challengesSection" class="tool-section" style="display:none">
          <h3 data-t="challenges">Daily Challenges</h3>
          <div id="challengesList" class="challenges-list"></div>
        </div>
      </div>

      <div id="SettingsTab" class="tab-content">
        <div class="tab-header"><h2 data-t="settings">Settings</h2></div>
        
        <div class="settings-section">
          <h3 data-t="yourPoints">Your Points</h3>
          <div class="points-display-large">
            <i class="fas fa-star"></i>
            <span id="settingsPoints">0</span>
            <span data-t="points">points</span>
          </div>
          <div class="level-display">Level: <strong id="settingsLevel">Bronze</strong></div>
        </div>

        <div class="settings-section">
          <h3 data-t="earnedBadges">Earned Badges</h3>
          <div id="myBadgesContainer" class="badges-grid"></div>
        </div>

        <div class="settings-section">
          <h3 data-t="language">Language</h3>
          <div class="lang-switcher">
            <button class="lang-btn active" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="ar">SA</button>
            <button class="lang-btn" data-lang="ur">URD</button>
          </div>
        </div>

        <div class="settings-section">
          <h3 data-t="darkMode">Appearance</h3>
          <label class="toggle-switch">
            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
            <span class="slider"></span>
            <span data-t="darkMode">Dark Mode</span>
          </label>
        </div>

        <div id="adminSection" class="settings-section" style="display:none">
          <h3 data-t="admin">Admin Panel</h3>
          <button class="btn btn-secondary" onclick="openModal('addNewsModal')"><i class="fas fa-plus"></i> <span data-t="addNews">Add News</span></button>
          <h4 data-t="pendingUsers">Pending Approvals</h4>
          <div id="pendingUsersContainer"></div>
        </div>

        <div class="settings-section">
          <button class="btn btn-danger" onclick="logout()"><i class="fas fa-sign-out-alt"></i> <span data-t="logout">Logout</span></button>
        </div>
      </div>
    </main>

    <nav class="bottom-nav">
      <button class="nav-button active" data-tab="HomeTab"><i class="fas fa-home"></i><span data-t="home">Home</span></button>
      <button class="nav-button" data-tab="ObservationsTab"><i class="fas fa-eye"></i><span data-t="observe">Observe</span></button>
      <button class="nav-button" data-tab="PermitsTab"><i class="fas fa-file-alt"></i><span data-t="permits">Permits</span></button>
      <button class="nav-button" data-tab="EquipmentTab"><i class="fas fa-truck"></i><span data-t="equipment">Equipment</span></button>
      <button class="nav-button" data-tab="MoreTab" onclick="toggleMoreMenu(event)"><i class="fas fa-ellipsis-h"></i><span data-t="more">More</span></button>
    </nav>

    <div id="moreMenu" class="more-menu" style="display:none">
      <button onclick="openTab(event,'TbtTab');hideMoreMenu()"><i class="fas fa-users"></i> <span data-t="toolboxTalks">Toolbox Talks</span></button>
      <button onclick="openTab(event,'LibraryTab');hideMoreMenu()"><i class="fas fa-book"></i> <span data-t="library">Library</span></button>
      <button onclick="openTab(event,'ToolsTab');hideMoreMenu()"><i class="fas fa-tools"></i> <span data-t="tools">Tools</span></button>
      <button onclick="openTab(event,'SettingsTab');hideMoreMenu()"><i class="fas fa-cog"></i> <span data-t="settings">Settings</span></button>
    </div>
  </div>

  <div id="loginModal" class="modal">
    <div class="modal-content modal-auth">
      <div class="modal-header"><i class="fas fa-hard-hat text-yellow"></i><h2 data-t="welcome">Welcome</h2></div>
      <div class="auth-tabs">
        <button class="auth-tab active" data-tab="login" data-t="login">Login</button>
        <button class="auth-tab" data-tab="register" data-t="register">Register</button>
      </div>
      <div id="authMessage" class="auth-message" style="display:none"></div>
      <form id="loginForm" class="auth-form">
        <input type="text" id="loginEmployeeId" data-t-placeholder="employeeId" placeholder="Employee ID" required autocomplete="username">
        <input type="password" id="loginPassword" data-t-placeholder="password" placeholder="Password" required autocomplete="current-password">
        <div id="loginError" class="error-text"></div>
        <button type="submit" class="btn btn-primary btn-block" data-t="loginBtn">Login</button>
      </form>
      <form id="registerForm" class="auth-form" style="display:none">
        <input type="text" id="regEmployeeId" data-t-placeholder="employeeId" placeholder="Employee ID" required>
        <input type="text" id="regName" data-t-placeholder="name" placeholder="Full Name" required>
        <input type="password" id="regPassword" data-t-placeholder="password" placeholder="Password" required autocomplete="new-password">
        <div id="registerError" class="error-text"></div>
        <button type="submit" class="btn btn-primary btn-block" data-t="registerBtn">Register</button>
      </form>
    </div>
  </div>

  <div id="addObservationModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header"><h2 data-t="addObservation">Add Observation</h2><button class="close-btn" onclick="closeModal('addObservationModal')">&times;</button></div>
      <form id="addObservationForm" class="form-grid">
        <div class="form-row">
          <div class="form-group"><label data-t="reportedBy">Reported By</label><input type="text" id="obsReportedBy" readonly class="readonly-field"></div>
          <div class="form-group"><label data-t="employeeId">Employee ID</label><input type="text" id="obsReportedById" readonly class="readonly-field"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label data-t="date">Date</label><input type="date" id="obsDate" required></div>
          <div class="form-group"><label data-t="time">Time</label><input type="time" id="obsTime"></div>
        </div>
        <div class="form-group"><label data-t="area">Area</label><select id="obsAreaSelect" required><option value="" data-t="selectArea">Select Area</option></select></div>
        <div class="form-group"><label data-t="location">Specific Location</label><input type="text" id="obsLocation"></div>
        <div class="form-group"><label data-t="activityType">Activity Type</label><select id="activityType"><option value="" data-t="selectActivity">Select Activity</option></select></div>
        <div class="form-group"><label data-t="observationClass">Observation Class</label><select id="obsClass" required><option value="Negative" data-t="negative">Negative Observation</option><option value="Positive" data-t="positive">Positive Observation</option></select></div>
        <div class="form-group"><label data-t="observationType">Observation Type</label><select id="obsType" required><option value="" data-t="selectObsType">Select Type</option></select></div>
        <div id="injuryGroup" class="form-group" style="display:none"><label data-t="hasInjury">Injury Occurred?</label><select id="hasInjury"><option value="no" data-t="noInjury">No Injury</option><option value="yes" data-t="injury">Injury</option></select></div>
        <div id="injuryTypeGroup" class="form-group" style="display:none"><label data-t="injuryType">Type of Injury</label><select id="injuryType"><option value="" data-t="selectInjuryType">Select Injury Type</option></select></div>
        <div class="form-group full-width"><label data-t="description">Description</label><textarea id="obsDescription" rows="3" required></textarea></div>
        <div class="form-group"><label data-t="directCause">Direct Cause</label><input type="text" id="obsDirectCause"></div>
        <div class="form-group"><label data-t="rootCause">Root Cause</label><input type="text" id="obsRootCause"></div>
        <div class="form-group"><label data-t="immediateAction">Immediate Action</label><input type="text" id="obsImmediateAction"></div>
        <div class="form-group"><label data-t="correctiveAction">Corrective Action</label><input type="text" id="obsCorrectiveAction"></div>
        <div class="form-group"><label data-t="responsiblePerson">Responsible Person</label><input type="text" id="obsResponsiblePerson" data-t-placeholder="responsiblePersonPlaceholder" placeholder="Person to fix this issue"></div>
        <div class="form-group"><label data-t="dueDate">Due Date</label><input type="date" id="obsDueDate"></div>
        <div class="form-group"><label data-t="riskLevel">Risk Level</label><select id="obsRiskLevel"><option value="Low" data-t="low">Low</option><option value="Medium" selected data-t="medium">Medium</option><option value="High" data-t="high">High</option></select></div>
        <div class="form-group full-width"><label data-t="evidence">Evidence Photos (Before)</label><input type="file" id="obsPhotos" accept="image/*" multiple></div>
        <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addObservationModal')" data-t="cancel">Cancel</button><button type="submit" class="btn btn-primary" data-t="submit">Submit</button></div>
      </form>
    </div>
  </div>

  <div id="addPermitModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="addPermit">Add Permit</h2><button class="close-btn" onclick="closeModal('addPermitModal')">&times;</button></div>
      <form id="addPermitForm" class="form-grid">
        <div class="form-group"><label data-t="date">Date</label><input type="date" id="permitDate" required></div>
        <div class="form-group"><label data-t="area">Area</label><select id="permitAreaSelect" required><option value="" data-t="selectArea">Select Area</option></select></div>
        <div class="form-group"><label data-t="permitType">Permit Type</label><select id="permitType" required><option value="Hot Work">Hot Work</option><option value="Confined Space">Confined Space</option><option value="Excavation">Excavation</option><option value="Electrical">Electrical</option><option value="General">General</option></select></div>
        <div class="form-group"><label data-t="permitNumber">Permit Number</label><input type="text" id="permitNumber"></div>
        <div class="form-group"><label data-t="project">Project</label><input type="text" id="permitProject"></div>
        <div class="form-group"><label data-t="receiver">Receiver</label><input type="text" id="permitReceiver"></div>
        <div class="form-group"><label data-t="issuer">Issuer</label><input type="text" id="permitIssuer"></div>
        <div class="form-group full-width"><label data-t="description">Description</label><textarea id="permitDescription" rows="3"></textarea></div>
        <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addPermitModal')" data-t="cancel">Cancel</button><button type="submit" class="btn btn-primary" data-t="submit">Submit</button></div>
      </form>
    </div>
  </div>

  <div id="addEquipmentModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header"><h2 data-t="addEquipment">Add Equipment</h2><button class="close-btn" onclick="closeModal('addEquipmentModal')">&times;</button></div>
      <form id="addEquipmentForm" class="form-grid">
        <div class="form-group"><label data-t="assetNumber">Asset Number</label><input type="text" id="eqAssetNumber" required></div>
        <div class="form-group"><label data-t="equipmentType">Equipment Type</label><input type="text" id="eqType" required></div>
        <div class="form-group"><label data-t="owner">Owner</label><input type="text" id="eqOwner"></div>
        <div class="form-group"><label data-t="yardArea">Yard/Area</label><select id="eqAreaSelect"><option value="" data-t="selectArea">Select Area</option></select></div>
        <div class="form-group"><label data-t="status">Status</label><select id="eqStatusSelect"><option value="In Service" data-t="inService">In Service</option><option value="Out of Service" data-t="outOfService">Out of Service</option></select></div>
        <div class="form-group"><label data-t="pwasRequired">PWAS Required</label><select id="eqPwas"><option value="Yes">Yes</option><option value="No">No</option></select></div>
        <div class="form-group"><label data-t="tpsDate">TPS Date</label><input type="date" id="eqTpsDate"></div>
        <div class="form-group"><label data-t="tpsExpiry">TPS Expiry</label><input type="date" id="eqTpsExpiry"></div>
        <div class="form-group"><label data-t="insDate">INS Date</label><input type="date" id="eqInsDate"></div>
        <div class="form-group"><label data-t="insExpiry">INS Expiry</label><input type="date" id="eqInsExpiry"></div>
        <div class="form-group"><label data-t="operatorName">Operator Name</label><input type="text" id="eqOperator"></div>
        <div class="form-group"><label data-t="operatorLicense">Operator License</label><input type="text" id="eqLicense"></div>
        <div class="form-group full-width"><label data-t="notes">Notes</label><textarea id="eqNotes" rows="2"></textarea></div>
        <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addEquipmentModal')" data-t="cancel">Cancel</button><button type="submit" class="btn btn-primary" data-t="submit">Submit</button></div>
      </form>
    </div>
  </div>

  <div id="addTbtModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="addTbt">Add Toolbox Talk</h2><button class="close-btn" onclick="closeModal('addTbtModal')">&times;</button></div>
      <form id="addTbtForm" class="form-grid">
        <div class="form-group"><label data-t="date">Date</label><input type="date" id="tbtDate" required></div>
        <div class="form-group"><label data-t="topic">Topic</label><input type="text" id="tbtTopic" required></div>
        <div class="form-group"><label data-t="presenter">Presenter</label><input type="text" id="tbtPresenter"></div>
        <div class="form-group"><label data-t="area">Area</label><input type="text" id="tbtArea"></div>
        <div class="form-group"><label data-t="attendance">Attendance</label><input type="number" id="tbtAttendance" min="0"></div>
        <div class="form-group full-width"><label data-t="description">Description</label><textarea id="tbtDescription" rows="3"></textarea></div>
        <div class="form-group full-width"><label data-t="evidence">Evidence Photos</label><input type="file" id="tbtPhotos" accept="image/*" multiple></div>
        <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addTbtModal')" data-t="cancel">Cancel</button><button type="submit" class="btn btn-primary" data-t="submit">Submit</button></div>
      </form>
    </div>
  </div>

  <div id="addNewsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="addNews">Add News</h2><button class="close-btn" onclick="closeModal('addNewsModal')">&times;</button></div>
      <form id="addNewsForm" class="form-grid">
        <div class="form-group full-width"><label data-t="title">Title</label><input type="text" id="newsTitle" required></div>
        <div class="form-group full-width"><label data-t="content">Content</label><textarea id="newsContent" rows="4" required></textarea></div>
        <div class="form-group"><label data-t="priority">Priority</label><select id="newsPriority"><option value="normal" data-t="normal">Normal</option><option value="urgent" data-t="urgent">Urgent</option><option value="critical" data-t="critical">Critical</option></select></div>
        <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addNewsModal')" data-t="cancel">Cancel</button><button type="submit" class="btn btn-primary" data-t="submit">Submit</button></div>
      </form>
    </div>
  </div>

  <div id="newsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="news">News</h2><button class="close-btn" onclick="closeModal('newsModal')">&times;</button></div>
      <div id="newsContainer"></div>
    </div>
  </div>

  <div id="leaderboardModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="monthlyLeaderboard">Monthly Leaderboard</h2><button class="close-btn" onclick="closeModal('leaderboardModal')">&times;</button></div>
      <div id="leaderboardContainer"></div>
    </div>
  </div>

  <div id="viewObservationModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header"><h2 data-t="view">View Observation</h2><button class="close-btn" onclick="closeModal('viewObservationModal')">&times;</button></div>
      <div id="viewObservationContent"></div>
    </div>
  </div>

  <div id="viewPermitModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="view">View Permit</h2><button class="close-btn" onclick="closeModal('viewPermitModal')">&times;</button></div>
      <div id="viewPermitContent"></div>
    </div>
  </div>

  <div id="viewEquipmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="view">View Equipment</h2><button class="close-btn" onclick="closeModal('viewEquipmentModal')">&times;</button></div>
      <div id="viewEquipmentContent"></div>
    </div>
  </div>

  <div id="viewTbtModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="view">View Toolbox Talk</h2><button class="close-btn" onclick="closeModal('viewTbtModal')">&times;</button></div>
      <div id="viewTbtContent"></div>
    </div>
  </div>

  <div id="closeObservationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2 data-t="closeObservation">Close Observation</h2><button class="close-btn" onclick="closeModal('closeObservationModal')">&times;</button></div>
      <div class="form-grid">
        <div class="form-group full-width">
          <label data-t="afterPhotos">After Photos (Evidence of Fix)</label>
          <input type="file" id="closeObsPhotos" accept="image/*" multiple>
        </div>
        <div class="form-group full-width">
          <label data-t="closingNotes">Closing Notes</label>
          <textarea id="closeObsNotes" rows="4" data-t-placeholder="closingNotesPlaceholder" placeholder="Describe what was done to resolve this observation..."></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('closeObservationModal')" data-t="cancel">Cancel</button>
          <button type="button" class="btn btn-success" onclick="submitCloseObservation()" data-t="closeObservation">Close Observation</button>
        </div>
      </div>
    </div>
  </div>

  <div id="offlineIndicator" class="offline-indicator" data-t="offlineMode">You are offline. Data will sync when connected.</div>

  <script src="/js/translations.js"></script>
  <script src="/js/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW registration failed:', err));
    }
    window.addEventListener('online', () => document.getElementById('offlineIndicator').classList.remove('show'));
    window.addEventListener('offline', () => document.getElementById('offlineIndicator').classList.add('show'));
  </script>
</body>
</html>
